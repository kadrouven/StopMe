<!DOCTYPE html>
{% load staticfiles %}
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>StopMe!</title>

	  <script src="{% static "js/jquery.js" %}"></script> <!-- JavaScript -->
	  
	  <!-- Bootstrap core CSS -->
	  <link rel="stylesheet" href="{% static "css/bootstrap.min.css" %}" />
	  
	  <!-- Custom styles for this template -->
	  <link href="{% static "navbar.css" %}" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="{% static "js/ie-emulation-modes-warning.js" %}"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <style>
      html, body{
        height: 100%;
      }
      #map {
        height: 100%;
      }
    </style>
  </head>

  <body>

    <div class="container" style="height:90%;">

      <!-- Static navbar -->
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">StopMe!</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li class="active"><a href="#">Home</a></li>
              <li><a href="#">About</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div><!--/.container-fluid -->
      </nav>

      <!-- Main component for a primary marketing message or call to action -->
      <div class="jumbotron" style="height:100%;">
        <h2>Choose a destination</h2>
        <p>
        <div class="btn-group" role="group" aria-label="...">
          <button type="button" class="btn btn-default" onclick="changeGoal(55.879706, -4.314566);" id='Hyndland'>Hyndland</button>
          <button type="button" class="btn btn-default" onclick="changeGoal(55.869878, -4.308829);" id='Partick'>Partick</button>
          <button type="button" class="btn btn-default" onclick="changeGoal(55.864638, -4.269819);" id='CharingCross'>Charing Cross</button>
          <button type="button" class="btn btn-default" onclick="changeGoal(55.862286, -4.251094);" id='QueenStreet'>Queen Street</button>
        </div>
        </p>
        <div id="text"></div>
        <div id="text2"></div>        
        <div id="map" style="height:85%"></div>
      </div>
    </div> <!-- /container -->
    
    
    <!-- MAP SCRIPTS -->    
    
    <script>
      // Note: This example requires that you consent to location sharing when
      // prompted by your browser. If you see the error "The Geolocation service
      // failed.", it means you probably did not give permission for the browser to
      // locate you.


      var map = null;
      var marker = null;
      var makerGoal = null;
      var pos = null;
      var distance = 0;
      
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 55.866170, lng: -4.251004},
          zoom: 11
        });

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
          navigator.geolocation.watchPosition(function(position) {
            
            // Get current location
            
            pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };

            // Update current location marker

            if (marker !== null) {
              marker.setPosition(pos);
            }else{
              marker = new google.maps.Marker({
                position: pos,
                map: map,
                title: 'Current Location',
                icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
              });
            }
            
            calculateDistance();
  
            // Centre Map
            map.setCenter(pos);
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
      }

      // Error Handling
      
      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
      }

      // Update Goal Marker
      
      function changeGoal(lat, lng){
        if(makerGoal !== null){
          var newPosition = {
            lat: parseFloat(lat),
            lng: parseFloat(lng)
          };
          makerGoal.setPosition(newPosition);
        }else{
          makerGoal = new google.maps.Marker({
              position: {lat: lat, lng: lng},
              map: map,
              title: 'Goal',
              icon: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'
            });
       }
        calculateDistance();
      }
      
      // Calculate Distance between current location and destination
      
      function calculateDistance(){
        if(makerGoal !== null){
          distance = getDistanceFromLatLonInKm(pos.lat, pos.lng, makerGoal.getPosition().lat(), makerGoal.getPosition().lng());
          document.getElementById('text').innerHTML = 'Distance to Destination: ' + distance;
        } 
      }

      // Distance Calculation

      function getDistanceFromLatLonInKm(lat1,lon1,lat2,lon2) {
        var R = 6371; // Radius of the earth in km
        var dLat = deg2rad(lat2-lat1);  // deg2rad below
        var dLon = deg2rad(lon2-lon1); 
        var a = 
          Math.sin(dLat/2) * Math.sin(dLat/2) +
          Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
          Math.sin(dLon/2) * Math.sin(dLon/2); 
        var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
        var d = R * c; // Distance in km
        return d;
      }
      
      function deg2rad(deg) {
        return deg * (Math.PI/180)
      }
    </script>
  
  
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDWm00u9WjNOK4f6Fr4yA06kdc4hx3Syqc&signed_in=true&callback=initMap"
        async defer>
    </script>

  
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="dist/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="assets/js/ie10-viewport-bug-workaround.js"></script>    

  
  </body>
</html>
